name: Auto update 3.7 branch

on:
    push:
        branches:
            - master
    
    workflow_dispatch:

jobs:
    translate:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout master branch
              uses: actions/checkout@v2
              with:
                ref: master
            
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r 
            
            - name: Run translation script
              run: |
                #!/bin/bash
                find . -type f -name "*.py" | while read -r file; do
                  echo "*** Translating $file ***"
                  python translate.py "$file"
                done
            
            - name: Run pytest
              run: python -m pytest
            
            - name: Commit changes
              run: |
                git config --local user.email "action@github.com"
                git config --local user.name "GitHub Action"
                git add .
                git commit -m "Automatic translation"
            
            - name: Create Pull Request
              run: |
                gh pr create --base translated --head master --title "[auto] 3.7 translation" --body "Update 3.7 translated branch following a successfull pytest run."
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}